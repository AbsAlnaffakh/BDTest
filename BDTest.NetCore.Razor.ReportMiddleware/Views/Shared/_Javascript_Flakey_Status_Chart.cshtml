@using BDTest.Test
@model BDTest.NetCore.Razor.ReportMiddleware.Models.ChartViewModel

@* Report IDs available for Javascript *@
    <script>


</script>

@* Success Trend Chart *@
<script>
{              
@* let reportIdsArray = [];

@foreach (var report in Model.Scenarios)
{
    @:reportIdsArray.push("@report.ssc");
}

function chartOnClick(chart, event) {
   let activePoint = chart.getElementAtEvent(event);
      
   if (activePoint.length > 0) {
      let clickedDatasetIndex = activePoint[0]._datasetIndex;
      let clickedElementindex = activePoint[0]._index;
      
      let clickedOnReportId = reportIdsArray[clickedElementindex];

      window.location.href = '@baseUrl/bdtest/report/' + clickedOnReportId + '/summary'
   }
} *@
    
let successChartContext = document.getElementById('success-trend-chart-@Model.Index').getContext('2d');
data = {
    datasets: [ 
        {
            label: "Failed",
            backgroundColor: "#f14668",
            borderColor: "rgba(0,0,0,0)",
            pointBorderColor: "#f14668",
            pointBackgroundColor: "#f14668",
            pointHitRadius: 15,
            pointRadius: 0,
            borderWidth: 0,
            data: [
                @string.Join(",", Model.Scenarios.Select(summary => summary.Status == Status.Failed ? 1 : 0))
            ]    
        },
        {
            label: "Inconclusive",
            backgroundColor: "#ffdd57",
            borderColor: "rgba(0,0,0,0)",
            pointBorderColor: "#ffdd57",
            pointBackgroundColor: "#ffdd57",
            pointHitRadius: 15,
            pointRadius: 0,
            borderWidth: 0,
            data: [
                @string.Join(",", Model.Scenarios.Select(summary => summary.Status == Status.Inconclusive ? 1 : 0))
            ]    
        },
        {
            label: "Not Implemented",
            backgroundColor: "#ffdd57",
            borderColor: "rgba(0,0,0,0)",
            pointBorderColor: "#ffdd57",
            pointBackgroundColor: "#ffdd57",
            pointHitRadius: 15,
            pointRadius: 0,
            borderWidth: 0,
            data: [
                @string.Join(",", Model.Scenarios.Select(summary => summary.Status == Status.NotImplemented ? 1 : 0))
            ]    
        },
        {
            label: "Skipped",
            backgroundColor: "#ffdd57",
            borderColor: "rgba(0,0,0,0)",
            pointBorderColor: "#ffdd57",
            pointBackgroundColor: "#ffdd57",
            pointHitRadius: 15,
            pointRadius: 0,
            borderWidth: 0,
            data: [
                @string.Join(",", Model.Scenarios.Select(summary => summary.Status == Status.Skipped ? 1 : 0))            
            ]    
        },
        {
            label: "Passed",
            backgroundColor: "#48c774",
            borderColor: "rgba(0,0,0,0)",
            pointBorderColor: "#48c774",
            pointBackgroundColor: "#48c774",
            pointHitRadius: 15,
            pointRadius: 0,
            borderWidth: 0,
            data: [
                @string.Join(",", Model.Scenarios.Select(summary => summary.Status == Status.Passed ? 1 : 0))
            ]    
        }
        ],

    labels: [
        @for (var index = 0; index < Model.Scenarios.Count; index++)
        {
            @:"Test Run #@index",
        }
    ]
}

var successChart = new Chart(successChartContext, {
    type: 'line',
    data: data,
    options: {
        legend: {
                    display: false
                },
        scales: {
            yAxes: [{
              scaleLabel: {
                labelString: 'Seconds'
              },
              stacked: true,
              ticks: {
                  beginAtZero:true,
                  // Include a dollar sign in the ticks
                  callback: function(value, index, values) {
                      return "";
                  }
                  }
            }]
          }
    }
});
}
</script>